\documentclass{itatnew}

\usepackage{paralist} % inparaenum support
\usepackage{varioref} % added by Viliam for \vref
\usepackage{xcolor} % added by Viliam for \textcolor

\usepackage{caption}
\usepackage{subcaption}
\usepackage{graphicx}
\usepackage{textcomp} % used for degrees celsius
\usepackage{booktabs}
\usepackage[british]{babel}

% ==========================================
% Custom commands (by Viliam)
% ==========================================
\newcommand{\FOCAL}[3]{ % usage: \FOCAL{R}{M}{op}
  \ifmmode
    #1{\stackrel{\mathtt{#3}}{\circ}}#2
  \else
    \begin{math}\FOCAL{#1}{#2}{#3}\end{math}
  \fi
}
\newcommand{\SOHUP}{
  \ifmmode
    SoH^\uparrow
  \else
  \begin{math}\SOHUP\end{math}
  \fi
}
\newcommand{\SOHDOWN}{
  \ifmmode
    SoH^\downarrow
  \else
  \begin{math}\SOHDOWN\end{math}
  \fi
}
% ==========================================


\begin{document}

\title{Stable Hot Spot Analysis (Draft)}

\author{
  Marc Gassenschmidt \and
  Viliam Simko  \and
  Julian Bruns
  \\
  \email{todo@fzi.de},
  \email{simko@fzi.de},
  \email{bruns@fzi.de}
}

\institute{
  FZI Forschungszentrum Informatik\\
  am Karlsruher Institut f\"ur Technologie\\
  76131, Haid-und-Neu-Str. 10-14\\
  Karlsruhe, Germany
}
  
\maketitle              % typeset the title of the contribution



\begin{abstract}
Hot spot analysis is essential for geo-statistics.
It supports decision making by detecting points
as well as areas of interest in comparison to their
neighbourhood. However, these methods are dependent
on different parameters, ranging from the resolution
of the study area to the size of their neighbourhood.
This dependence can lead to instabilities of the detected
hotspots, where the results can highly vary between
different parameters. A decision maker can therefore ask
how valid the analysis actually is.
%
In this study, we examine the impact of key parameters
on the stability of the hotspots, namely the size of
the neighbourhood, the resolution and the size of the
study area, as well as the influence of the ratio between
those parameters.
%
We compute the hotspots with the well known Getis-Ord ($G^*$)
statistic as well as its modification, the \emph{Focal $G^*$} statistic.
We measure the stability of the hotspot analysis using
a recently introduced \emph{stability of hotspots} metric (SoH)
and compare the results to intuitive visual analysis.
%
We evaluate the results on real world data with the well-known
yellow cab taxi data set from New York, Manhattan.
Our results indicate a negative impact on the stability with
an increase of the size of the neighbourhood as well as
a reduction of the size of the study area, regardless of
the resolution.
\end{abstract}


\section{Introduction}
The goal of hotspot analysis is the detection and identification of interesting areas. It achieves this goal by computing statistically significant deviations from the mean value of a given study area. This allows a decision maker to easily identify those areas of interest and allows further focus in sub-sequential data analysis or the decision focus. Typical applications range from crime detection over identification of disease outbreaks to urban heat islands. In such applications, scarce resources are then often applied in only those identified hotspots or used as the basis for the allocation. The general approach is an unsupervised learning method similar to a cluster analysis. 

But, similar to a cluster analysis, there does exist a high dependency of the identified hotspots on the detection method and in particular the parametrization of this method. The identified areas as well as their shape can vary highly. This volatility can lead to a decrease in trust in the result or in suboptimal allocations of scarce resources. Therefore it is necessary to measure and evaluate the stability of a hotspot analysis as well as the different parametrizations. 
In our initial work (Hier Bruns and VIliam 2017), we introduced a method to measure the stability of hotspots, the \emph{stability of hotspots} metric (SoH) and showed its use on the basis of temperature data .   
Here, we build upon that work and examine in more detail the impact of the different instantiations of the most typical parameter. We use the well known Getis-Ord statistic \cite{Ord.1995}, the standard $G^*$, and a modification of this statistic, the focal $G^*$ (citate bruns and viliam). Those parameter are the size of the study area (focal matrix), the detail of the resolution (zoom) and the size of the neighbourhood (weight matrix). By varying over these parameter, we can compare the stability for all possible combinations and isolate the effect of single parameter by aggregation over the other parameter. 
We evaluate on the well-known taxi data set to show the applicability on real world use cases as well as to enable a simple replication. 


\section{Related Work}

\subsection{Quality of Clustering}
The problem of assessing the quality in unsupervised learning is well known. In the case of the k-mean algorithm, the quality of the clustering is mostly dependent on the value of the \emph{k} and a miss-specification can lead to highly irregular clusters. In a simple 2D clustering, they can be easily recognized by visual analysis, but in higher dimensionality, this is impossible. One method, to measure the quality of such a clustering is the compactness of the clusters, see e.g. Song 2010 (http://ieeexplore.ieee.org/document/5558958/?part=1). This enables the comparison between different clusters. Another possibility is the Silhouette Coefficient by Kaufman et Rousseeuw 1990. This metric measures the similarity of objects in a cluster in comparison to other clusters. For density based clustering, e.g. for DBSCAN, OPTICS (Ankerst et al 1999) gives a simple method to tune the essential parameter for this clustering. This is only a small overview of methods to influence and measure the quality of different clustering methods. But it shows that this problem is not easily solved and dependent on the chosen algorithm. To our knowledge, there does not exist a method to overall measure the stability of a clustering.

\subsection{Hot Spot Analysis}
The goal of hotspot analysis is the detection of interesting areas as well as patterns in spatial information. One of the most fundamental approach is Moran´s I~\cite{MoranI}. There it is tested whether or
not a spatial dependency exists. This gives the information on global
dependencies in a data set. Upon this hypothesis test several geo-statistical
tests are based. The most well known are the Getis-Ord statistic~\cite{Ord.1995}
and LISA~\cite{Anselin.1995}. In both cases the general, the global statistic of
Moran´s I is applied in a local context. The goal is to detect not only global
values, but instead to focus on local hotspots and to measure the significance
of those local areas. A more in depth overview of methods to identify and visualize spatial patterns and areas of interest can be found in Shekhar et al (2011). 

\section{Stability of Hot Spot Analysis}
\label{sec:Metric}

Existing methods for determining hot spots are dependent on the parametrization
of the weight matrix as well as on the size of the study area. Intuitively,
increasing the size of a weight matrix has a "blurring" effect on the raster
(Fig.~\ref{def:TODO}a) whereas decreasing the size can be seen as a form of
"sharpening" (Fig.~\ref{def:TODO}b).

%TODO: add image showing and blurring/sharpening effects

%As we can see, hot spots are oftentimes disappearing or appearing unrelated to
%previously found hot spots. While these computations indeed show hot spots and
%the results are correct, they lack stability.

For a data analyst, when exploring the data interactively by choosing different
filter sizes (weight matrices) or point aggregation strategies (pixel sizes), it
is important that the position and size of a hot spot changes in a predictable
manner. We formalize the intuition in our stability metric.

%
%Consider the real-world example depicted in Fig.~\ref{fig:TempMaps}.
%%TODO: thermal flight -> NY taxi
%The temperature map of a morning thermal flight dataset 
%(Fig.~\ref{fig:TempMaps:a}) has been processed using $G^*$.
%
%%TODO: thermal flight -> NY taxi
%%TODO: need two images - G* and FocalG*
%\begin{figure}[htp]
%  \begin{subfigure}{1\linewidth}
%    \caption{Morning temperatures}
%    \includegraphics[width=\linewidth]{images/hotspot-rawtemp-1}
%    \label{fig:TempMaps:a}
%  \end{subfigure}
%  
%  \caption{
%    Karlsruhe city center.
%    Selected area of $2.4{\times}1.4\,km$.
%    Pixel size $5{\times}5\,m$.
%  }
%  \label{fig:TempMaps}
%\end{figure}


We define a hot spot found in comparably more coarse resolutions as
\emph{parent} (larger weight matrix or larger pixel size) and in finer
resolutions as \emph{child} (smaller weight matrix or smaller pixel size).

That is 

To be stable, one assumes that every parent has at
least one child and that each child has one parent. For a perfectly stable
interaction, it can be easily seen that the connection between parent and child
is a injective function and between child and parent a surjective function. To
measure the closeness of connection, we propose a metric called the
\emph{Stability of Hot spot} (SoH). It measures the deviation from a perfectly
stable transformation of resolutions.



In its downward property (from parent to child, injective) it is defined as:
\begin{equation}
  \label{eq:SoH-down}
  \SOHDOWN
    = \frac{ParentsWithChildNodes}{Parents}
    = \frac{|Parents \cap Children|}{|Parents|}
\end{equation}
And for its upward property (from child to parent, surjective):
\begin{equation}
  \label{eq:SoH-up}
  \SOHUP
    = \frac{ChildrenWithParent}{Children}
    = 1 - \frac{|Children - Parents|}{|Children|}
\end{equation}
where $ParentsWithChildNodes$ is the number of parents that have at least one 
\emph{child}, $Parents$ is the total number of \emph{parent}, 
$ChildrenWithParent$ is the number of children and $Children$ as the total 
number of children.
The SoH is defined for a range between 0 and 1, where 1 represents a perfectly 
stable transformation while 0 would be a transformation with no stability at 
all.

\section{Focal Getis-Ord} \label{sec:FocalGetisOrd}

\subsection{Dataset}

Our results are based on the cab taxi data set from New York, Manhattan \cite{TODO}. 
We used only the dataset of January 2016. From that
dataset we used the $pickup\_longitude$ and $pickup\_latitude$ column. 
The borders of the raster are between (40.699607, -74.020265) and (40.769239, -73.948286). 
Zoom size 1 means we aggregate every point, which was in range of 100x100*0.000001 into one pixel. 
In zoom size N we aggregated NxN pixel from zoom size 1 into a new pixel.
%
For our measurements we specified the following data series:
\begin{itemize}
 \item The weight matrix W is from 3 to 43 with a stepsize of 4.
 \item The focal matrix F is from  17 to 125 with a stepsize of 12.
 \item The zoom level is from 1 to 5 with a stepsize of 1.
\end{itemize}
Therefore we calculate around 10*10*5=500 results for each fixed x.
The following conditions must hold F>W, F<Raster.cols und F<Raster.rows.


\subsection{Method}

In the following text, we use the notation \FOCAL{R}{M}{op} to denote a focal
operation $op$ applied on a raster $R$ with a focal window determined by a
matrix $M$. This is rougly eqivalent to a command \verb|focal(x=R, w=M, fun=op)|
from package \emph{raster} in the R programming language \cite{cran:raster}.

\begin{definition}[$G^*$ function on rasters]
  \label{def:GenericGetisOrdFunc}
  
  The function $G^*$ can be expressed as a raster operation:
  
  \begin{displaymath}
    G^*(R, W, st) =
    \frac{
      \FOCAL{R}{W}{sum} - M*\sum_{w \in W}{w}
    }{
      S \sqrt{
        \frac{
          N*\sum_{w \in W}{w^2} - (\sum_{w \in W}{w})^2
        }{
          N - 1
        }
      }
    }
  \end{displaymath}
  \noindent where:
  \begin{itemize}
    
    \item $R$ is the input raster.
    
    \item $W$ is a weight matrix of values between 0 and 1.
    
    \item $st = (N, M, S)$ is a parametrization specific to a particular version
    of the $G^*$ function. (Def.\vref{def:StdGetisOrdVersion} and
    \vref{def:FocalGetisOrdVersion}).
    
  \end{itemize}
\end{definition}

\begin{definition}[Standard $G^*$ parametrization]
  \label{def:StdGetisOrdVersion}
  
  Computes the parametrization $st$ as global statistics for all pixels in the
  raster $R$:
  
  \begin{itemize}
    \item $N$ represents the number of all pixels in $R$.
    \item $M$ represents the global mean of $R$.
    \item $S$ represents the global standard deviation of all pixels in $R$.
  \end{itemize}
\end{definition}

\begin{definition}[Focal $G^*$ parametrization]
  \label{def:FocalGetisOrdVersion}
  
  Let $F$ be a boolean matrix such that: $all(dim(F) \geq dim(W))$.
  This version uses focal operations to compute per-pixel statistics given by 
  the focal neighbourhood $F$ as follows:
  
  \begin{itemize}
    
    \item $N$ is a raster computed as a focal operation \FOCAL{R}{F}{sum}. Each
    pixel represents the number of pixels from $R$ convoluted with the matrix
    $F$. 
    
    \item $M$ is a raster computed as a focal mean \FOCAL{R}{F}{mean}, thus each
    pixel represents a mean value of its $F$-neighbourhood.
    
    \item $S$ is a raster computed as a focal standard deviation
    \FOCAL{R}{F}{sd}, thus each pixel represents a standard deviation of its
    $F$-neighbourhood.
    
  \end{itemize}
  
\end{definition}

\section{Results}




\section{Evaluation}

- To evaluate, we compare G* with FocalG* on the same dataset.
- We use NY taxi dropoffs
- a single evaluation run is defined in Def.~\ref{def:EvalRun}.
- In an ideal case, we could produce a 3D-plot:
  - x-axis would be growing pixel sizes 100..1000 by 100 (aka zoom-out)
  - y-axis would be growing weight matrix sizes (e.g. 5..41 by 2)
  - z-axis would be performance of G* vs FocalG* x and y coordinates
  - we could also repeat the computation for multiple datasets to obtain 
  multiple samples and to compute error bars.
- due to paper size limit, we choose projection in which matrix size is set to 
constant 7x7 pixels and the only variable is the pixel size. This way, we 
produce a 2D plot. We also generate just a single sample.

\begin{definition}[Evaluation Run]
  \label{def:EvalRun}
  We define a single evaluation run as a tuple:
  \begin{displaymath}
    E = (V, m, p, w)
  \end{displaymath}
  \noindent where:
  \begin{itemize}
  
    \item $V$ is the input dataset of points, representing the taxi dropoffs in 
    our case.
    
    \item $m$ is the metric used, in our case either \SOHUP or \SOHDOWN.
    
    \item $p$ represents the pixel size for aggregating points from $V$, 
    e.g. $100 \times 100$ meters.
    
    \item $w$ represents the size of a weight matrix.
    In our case, we chose a weight matrix depicted in 
    Figure~\ref{fig:ExampleMatrices}(a) for both the G* and FocalG* cases.
  \end{itemize}
\end{definition}

%Fig.~\ref{fig:ComparisonMorning} and Fig.~\ref{fig:ComparisonEvening} show
%Standard and Focal $G^*$ computations for both morning and eventing datasets
%with weight matrix $W$ of size 3, 5, 7, 9, 15 and 31. In this figures, when 
%computing Focal
%$G^*$, the focal matrix $F$ has a constant size of $61{\times}61$ cells. 
%Example weight matrix $W$ and focal matrix $F$ are depicted in 
%Fig.~\ref{fig:ExampleMatrices}.


\subsection{Clumping}

\subsection{Zoom}

Blueline is Focal $G^*$. Redline is $G^*$

\begin{figure}[htp]
  \begin{subfigure}{\linewidth}
    \caption{Upward}
    \includegraphics[width=\linewidth]{images/SoHZoomUp}
    \label{fig:UpwardZoom}
  \end{subfigure}
  \hspace{1em}
  \begin{subfigure}{\linewidth}
    \caption{Downward}
    \includegraphics[width=\linewidth]{images/SoHZoomDown}
    \label{fig:DownwardZoom}
  \end{subfigure}
  \caption{TODO}
  \label{fig:Zoom}
\end{figure}


\subsection{Blur}

The evaluation results are plotted in Fig.~\ref{fig:EvalResults}, each point in
the graph represents the \SOHUP metric (Eq.\ref{eq:SoH-up}) between two
$G^*$ generated using weight matrices of size $i$ and $i+2$. The focal matrix F
has a fixed size of $41{\times}41$

\begin{displaymath}
\SOHUP( G^*(R, W_i, st), G^*(R, W_{i+2}, st) )
\end{displaymath}

\begin{figure}[htp]
  \begin{subfigure}{\linewidth}
    \caption{Upward}
    \includegraphics[width=\linewidth]{images/SoHUpBlur}
    \label{fig:UpwardBlur}
  \end{subfigure}
  \hspace{1em}
  \begin{subfigure}{\linewidth}
    \caption{Downward}
    \includegraphics[width=\linewidth]{images/SoHDownBlur}
    \label{fig:DownwardBlur}
  \end{subfigure}
  \caption{TODO}
  \label{fig:Blur}
\end{figure}


\subsection{Results and Discussion}

% Focal size  
%	Increase of focal size leads to better results in the upward property
% 	Standard deviation decrease with higher focal size 
%	No standard deviation af F 17x17 because of missing clusters
%	The downward property reaches its maximum at 65x65
%
%	Conclusion: F should be around 65x65 or higher
In figure ~\ref{fig:fUp} you can see that an increase of the focal size leads to better results for $SoH^{\uparrow}$. 
The standard deviation decreases also with a higher focal size. Only 
at focal size F of 17x17 there is no standard deviation. At focal size F 17x17 the standard deviation is 
missing, because the weight size W must be smaller than F. When F and W have similar
size, there are no clusters. (TODO assumtion for SOH, if no clusters we asume Up/Down = 0)
$SoH^{\downarrow}$ in figure ~\ref{fig:fDown} reaches its maximum for focal size F 65x65 in the regarded area.

\begin{figure}[htp]
  \begin{subfigure}{\linewidth}
    \caption{SoH up for focal size}
    \includegraphics[width=\linewidth]{images/whiskerPlot/fUp}
    \label{fig:fUp}
  \end{subfigure}
  \hspace{1em}
  \begin{subfigure}{\linewidth}
    \caption{SoH down for focal size}
    \includegraphics[width=\linewidth]{images/whiskerPlot/fDown}
    \label{fig:fDown}
  \end{subfigure}
  \caption{SoH for focal size}
  \label{fig:SoHFocal}
\end{figure}

%
% Weight size
%	Increase of weight leads to increase of downward property
%	Small break downs for G* for upward and downward property
%	For the upward property Focal G* is better than G*
%
%	Conclusion: Higher weight size leads to better results. There are parametrisations of Focal G* which are better than G*
In figure ~\ref{fig:wDown} one can see that an increase of the weight size leads to better results.
Focal $G^*$ is not allways better than $G^*$ which would be a perfect result we hoped for. But it seems 
that $G*$ has at 23 and 39 some parametrisation which leads to small break downs. 
The standard deviation is in this area higher than in the other points.
In figure ~\ref{fig:wUp} the break downs are also visible.
The high standard deviation indicates that it is possible to use this parametrisation for better results
The $SoH^{\uparrow}$ in ~\ref{fig:wUp} is mostly better than $G^*$ which was our conclusion in \ref{TODO last paper}.

\begin{figure}[htp]
  \begin{subfigure}{\linewidth}
    \caption{SoH up for weight size}
    \includegraphics[width=\linewidth]{images/whiskerPlot/wUp}
    \label{fig:wUp}
  \end{subfigure}
  \hspace{1em}
  \begin{subfigure}{\linewidth}
    \caption{SoH down for weight size}
    \includegraphics[width=\linewidth]{images/whiskerPlot/wDown}
    \label{fig:wDown}
  \end{subfigure}
  \caption{SoH for weight size}
  \label{fig:SoHWeight}
\end{figure}
%
% Zoom
%	G* alwas better than Focal G* for upward and downward property
%	Focal G* has different focal sizes because zoom is compared
%	At zoom level 4 G* increase much more than Focal G*
%
%	Conclusion: G* is better than Focal G* in the zoom dimension, but the focal size is fixed. The zoom dimension has the least 
%	influence on the value
The last variation we examined was the zoom level. The results can seen in figure ~\ref{fig:SoHZoom}. One can see that $G^*$ is always better than Focal $G^*$.
The target area of Focal $G^*$ increases with every zoom step. 

\begin{figure}[htp]
  \begin{subfigure}{\linewidth}
    \caption{SoH up for focal size}
    \includegraphics[width=\linewidth]{images/whiskerPlot/zUp}
    \label{fig:zUp}
  \end{subfigure}
  \hspace{1em}
  \begin{subfigure}{\linewidth}
    \caption{SoH down for focal size}
    \includegraphics[width=\linewidth]{images/whiskerPlot/zDown}
    \label{fig:zDown}
  \end{subfigure}
  \caption{SoH for focal size}
  \label{fig:SoHZoom}
\end{figure}

\section{Conclusions and Future Work} \label{sec:Conclusion}
In this work, we compared the Getis-Ord statistic with Focal Getis-Ord statisitic on a different dataset.
We examined further parameters and evaluated that $G^*$ and Focal $G^*$ performe better if the weight
is higher.
Our results indicate a high Focal range for the upward property and a maximum of 65x65 for the downward property.
Therefore F should be not less than 65x65. 
If we calculate the SoH for the zoom level, Getis-Ord leads to better results. In general the zoom level 
has the least influence if $G^*$ or Focal $G^*$ performe better.
We assume that if Focal $G^*$ has a different Focal size for a different zoom level, it performes better, but this is beyond the
scope of this work.

With this work we made a step further to the optimal parametrisation for $G^*$ and Focal $G^*$.
All our results are based on the SoH. Further work should validate or improve this metric and compare if
Focal $G^*$ can have better results than $G^*$ in all dimension with fixed weight and focal size.




\section{Acknowledgements}
This work is part of the research project BigGIS (reference number: 01IS14012)
funded by the Federal Ministry of Education and Research (BMBF) within the
frame of the programme "Management and Analysis of Big Data" in "ICT 2020 --
Research for Innovations".
We thank the Nachbarschaftsverband Karlsruhe for the data of the thermal flight
over Karlsruhe. %
\noindent R-packages used: \verb|raster|~\cite{cran:raster}, 
\verb|knitr|~\cite{cran:knitr}

\bibliographystyle{plain}
\bibliography{bibfile}  % sigproc.bib is the name of the

\end{document}
